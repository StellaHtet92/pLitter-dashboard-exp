<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Test Page</title>
        <style>
            #map { height: 100vh; 
            margin:0;
            position: relative;
            z-index: 1;
            }
            iframe {    
              
                position: relative;
                z-index: 2;   
                top:-420px;
                left:50px;
                visibility:hidden;
            }
        </style>
         <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
         integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
         crossorigin=""/>
    </head>
    <body>
        <div id="container">
            <div id="map">
            </div>
          <!--  <iframe id="IPlayer" width="420" height="315" src="http://www.youtube.com/embed/hgts0sn19oo" display="none">  base url: https://www.youtube.com/embed/your_video_name-->
          <!--  </iframe>-->
          <div id="IPlayer"> </div>

        </div>
    </body>
</html>
 <!-- Make sure you put this AFTER Leaflet's CSS -->
 <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
   integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
   crossorigin="">
</script>
<script src="http://www.youtube.com/player_api"></script>
<!--<script src="testHeatMapData.js"></script>-->
<!--geojson1 is the selection of geojson features which have uploaded youtube-video-->
<script src='geojson1.js'></script>
<script src='convertplitter2geojson.js'></script>

<script>
    //for iframe player api
     var tag = document.createElement('script');
     tag.id = 'iframe-demo';
     tag.src = 'https://www.youtube.com/iframe_api';
     var firstScriptTag = document.getElementsByTagName('script')[0];
     firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    
    var map = L.map('map').setView([10.0042388, 105.7902111], 13);

    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'mapbox/streets-v11',
    tileSize: 512,
    zoomOffset: -1,
    accessToken: 'pk.eyJ1IjoiaHRldHlhbWluIiwiYSI6ImNrZmRyYnpqMzAxOTEycXBhdXA3MnVpOTMifQ.FLWujZQkT6BeMcSIQz0a8Q'
}).addTo(map);

var geojsonMarkerOptions = {
    radius: 4,
    fillColor: "#ff0000",
    color: "#000",
    weight: 1,
    opacity: 1,
    fillOpacity: 0.8
};
var marker=new Array();
var i;
function itemWrap(items) {
   
for(i=0;i<items.length;i++){
   
    var LamMarker = new L.marker([items[i].lat, items[i].lng]);
    marker=new Array();
    marker.push(LamMarker);
    map.addLayer(LamMarker);
    }
}

/*Going through these marker-items again removing them
code from https://stackoverflow.com/questions/9912145/leaflet-how-to-find-existing-markers-and-delete-markers*/
function markerDelAgain() {
   
    
    for(var i=0;i<marker.length;i++) {
    
    map.removeLayer(marker[i]);
   // alert('markerDelAgain');
    }  
   
    
}
var name;
var id_Picture;
var start_time;
function onEachFeature(feature, layer) {
  
    layer.on('click', function (e) {  

      name=feature.properties.name.slice(0, 8);
      console.log('name');
      console.log(name);
      id_Picture=feature.properties.name.slice(9, feature.properties.name.length-4);
      var lng=feature.geometry.coordinates[0];
      //console.log(lat);
      //console.log('lat');
      var lat=feature.geometry.coordinates[1];
      //console.log(lng);
     // console.log('lng');
     markerDelAgain();
      var items=[{"lat":lat,"lng":lng}];
     
      itemWrap(items);
      start_time=Math.round(id_Picture*2.2);
        console.log("Time");
        console.log(start_time);
        //for iframe player
       
        var player;

        
        //layer.bindPopup(feature.properties.name);
        //link to download videos=>https://street.plitter.org/media/Can%20Tho/January_2022/your_path_name.MP4
        //<iframe allowfullscreen="" frameborder="0" height="315" src="http://www.youtube.com/embed/UkWd0azv3fQ?start=90" width="420"></iframe>
       if (name.localeCompare("GH010009")==0 )
      // if(name=="GH010009")
        {
            player = new YT.Player('IPlayer', {
                    height: '390',
                    width: '640',
                    videoId: 'hgts0sn19oo',
                    playerVars: {
                    'playsinline': 1
                    },
                    events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                    },
                    playerVars: {
                        start: start_time,
                        end: 60
                    }
                });
                document.getElementById("IPlayer").style.visibility = 'visible';

        }
        //else if (name.localeCompare("GH010016")==0)
        else if(name.localeCompare("GH010016")==0)
        {
           // document.getElementById("IPlayer").src = 'https://www.youtube.com/embed/rf2hyN3Kl9c?start='+time;
          
         
            player = new YT.Player('IPlayer', {
                    height: '390',
                    width: '640',
                    videoId: 'rf2hyN3Kl9c',
                    playerVars: {
                    'playsinline': 1
                    },
                    events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                    },
                    playerVars: {
                        start: start_time,
                        end: 60
                    }
                });
                document.getElementById("IPlayer").style.visibility = 'visible';
                
           
        }
        else if (name.localeCompare("GH010021")==0)
        {
         
          player = new YT.Player('IPlayer', {
                    height: '390',
                    width: '640',
                    videoId: 'GQix07cCRSQ',
                    playerVars: {
                    'playsinline': 1
                    },
                    events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                    },
                    playerVars: {
                        start: start_time,
                        end: 60
                    }
                });
                document.getElementById("IPlayer").style.visibility = 'visible';
                
           
        }
        else if (name.localeCompare("GH010022")==0)
        {
     
            player = new YT.Player('IPlayer', {
                    height: '390',
                    width: '640',
                    videoId: 'EBMiR8Z3gR4',
                    playerVars: {
                    'playsinline': 1
                    },
                    events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                    },
                    playerVars: {
                        start: start_time,
                        end: 60
                    }
                });
                document.getElementById("IPlayer").style.visibility = 'visible';
           
        }
        else if (name.localeCompare("GH010025")==0)
        {
         
          player = new YT.Player('IPlayer', {
                    height: '390',
                    width: '640',
                    videoId: 'p82Om_A9f7g',
                    playerVars: {
                    'playsinline': 1
                    },
                    events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                    },
                    playerVars: {
                        start: start_time,
                        end: 60
                    }
                });
                document.getElementById("IPlayer").style.visibility = 'visible';
           
        }
        else if (name.localeCompare("GH010027")==0)
        {
          //document.getElementById("IPlayer").src = 'https://www.youtube.com/embed/XnL-B1rnJfc?start='+time;
          // player=onYouTubeIframeAPIReady('XnL-B1rnJfc');
        // playTime = player.getCurrentTime();
        // console.log(playTime);
         player = new YT.Player('IPlayer', {
                    height: '390',
                    width: '640',
                    videoId: 'XnL-B1rnJfc',
                    playerVars: {
                    'playsinline': 1
                    },
                    events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                    },
                    playerVars: {
                        start: start_time,
                        end: 60
                    }
                });
                document.getElementById("IPlayer").style.visibility = 'visible';
            
        }
        else if (name.localeCompare("GH010028")==0)
        {
         
        player = new YT.Player('IPlayer', {
                    height: '390',
                    width: '640',
                    videoId: 'XvpN5_-vgr0',
                    playerVars: {
                    'playsinline': 1
                    },
                    events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                    },
                    playerVars: {
                        start: start_time,
                        end: 60
                    }
                });
                document.getElementById("IPlayer").style.visibility = 'visible';
            
        }
            
       
        //https://youtu.be/JnN-gL3zKHk
        else if (name.localeCompare("GH030030")==0)
        {
         
           player = new YT.Player('IPlayer', {
                    height: '390',
                    width: '640',
                    videoId: 'JnN-gL3zKHk',
                    playerVars: {
                    'playsinline': 1
                    },
                    events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                    },
                    playerVars: {
                        start: start_time,
                        end: 60
                    }
                });
                document.getElementById("IPlayer").style.visibility = 'visible';
           
        }
        else 
        {
            //document.getElementById("IPlayer").src = 'https://www.youtube.com/embed/hgts0sn19oo'+'?start='+id_Picture;
            //max= getMax(name);
            //console.log("Max of Feature of that route:");
            //window.alert('Video not found');
            document.getElementById("IPlayer").style.display = 'hidden';
            
        }   
        document.getElementById("IPlayer").style.display = 'true';
       
        //map.removeLayer(marker);  
    });
}

L.geoJSON(geojson_array, {
    pointToLayer: function (feature, latlng) {
        return L.circleMarker(latlng, geojsonMarkerOptions);
    }, 
    onEachFeature: onEachFeature
}).addTo(map);
  


// 3. This function creates an <iframe> (and YouTube player)
//    after the API code downloads.
var player;
// 4. The API will call this function when the video player is ready.
function onPlayerReady(event) {
  event.target.playVideo();
  var feature_name=name+"_"+id_Picture+1;
    var j,k,lat,lng;
  if (event.data == YT.PlayerState.PLAYING) {
   // To get the current playing time
    var time = event.target.getCurrentTime();
    //alert('onplayerstatechange')
    console.log(time);
    console.log('current time');
    console.log(name);
    console.log('current feature name');
    console.log(id_Picture);
    console.log('ID picture');
    console.log(start_time);
    console.log('Start Time');
    if(time-start_time>0.2)
        {
            alert('time-start_time');
         //geojson_array.feature   
         console.log("feature_name");
         console.log(feature_name);
         for(j=0;j<geojson_array.length;j++)
         {
            for (k=0;k<geojson_array[j].features[k].length;k++)
            {
                if(feature_name.localeCompare(geojson_array[j].features[k].properties.name)==0)
                {
                    var lng=geojson_array[j].features[k].geometry.coordinates[0];
                    var lat=geojson_array[j].features[k].geometry.coordinates[1];
                    console.log(lat);
                    console.log('lat onPlayerStateChange');
                    console.log(lng);
                    console.log('lng onPlayerStateChange');
                    
                    var items=[{"lat":lat,"lng":lng}];
     
                    itemWrap(items);
                    start_time=time;
                }
            }
           
         }
        }
     }
}

// 5. The API calls this function when the player's state changes.
//    The function indicates that when playing a video (state=1),
//    the player should play for six seconds and then stop.
//var done = false;
function onPlayerStateChange(event) {
    var feature_name=name+"_"+id_Picture+1;
    var j,k,lat,lng;
  if (event.data == YT.PlayerState.PLAYING) {
   // To get the current playing time
    var time = event.target.getCurrentTime();
    //alert('onplayerstatechange')
    console.log(time);
    console.log('current time');
    console.log(name);
    console.log('current feature name');
    console.log(id_Picture);
    console.log('ID picture');
    console.log(start_time);
    console.log('Start Time');
    if(time-start_time>0.2)
        {
            alert('time-start_time');
         //geojson_array.feature   
         console.log("feature_name");
         console.log(feature_name);
         for(j=0;j<geojson_array.length;j++)
         {
            for (k=0;k<geojson_array[j].features[k].length;k++)
            {
                if(feature_name.localeCompare(geojson_array[j].features[k].properties.name)==0)
                {
                    var lng=geojson_array[j].features[k].geometry.coordinates[0];
                    var lat=geojson_array[j].features[k].geometry.coordinates[1];
                    console.log(lat);
                    console.log('lat onPlayerStateChange');
                    console.log(lng);
                    console.log('lng onPlayerStateChange');
                    
                    var items=[{"lat":lat,"lng":lng}];
     
                    itemWrap(items);
                    start_time=time;
                }
            }
            //if(geojson_array[j].data.)
         }
        }
     }
}
function stopVideo() {
  player.stopVideo();
}
</script>